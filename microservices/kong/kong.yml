_format_version: '3.0'
_transform: true

services:
  - name: customer-service
    url: http://customer-service:3001
    plugins:
      - name: rate-limiting
        config:
          minute: 100
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: customer-routes
        paths:
          - /api/customers

  - name: cache-service
    url: http://cache-service:3002
    plugins:
      - name: rate-limiting
        config:
          minute: 100
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: cache-routes
        paths:
          - /api/cache

  - name: order-service
    url: http://order-service:3003
    plugins:
      - name: rate-limiting
        config:
          minute: 200
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: order-routes
        paths:
          - /api/orders
          - /api/v1/orders
    
  - name: order-service-prisma
    url: http://order-service-prisma:3007
    plugins:
      - name: rate-limiting
        config:
          minute: 200
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: order-routes-prisma
        paths:
          - /api/orders-prisma

  - name: payment-service
    url: http://payment-service:3004
    plugins:
      - name: rate-limiting
        config:
          minute: 50
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: payment-routes
        paths:
          - /api/payments

  - name: chat-service
    url: http://chat-service:3005
    plugins:
      - name: rate-limiting
        config:
          minute: 100
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: chat-routes
        paths:
          - /api/chat

  - name: file-service
    url: http://file-service:3006
    plugins:
      - name: rate-limiting
        config:
          minute: 150
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: file-routes
        paths:
          - /api/files
          - /api/v1/file-upload/upload

  - name: main-backend
    url: http://main-backend:7000
    plugins:
      - name: rate-limiting
        config:
          minute: 200
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: menu-services-routes
        paths:
          - /api/v1/menu-services
          - /api/v1/menu-services/
          - /api/v1/menu-services/(.*)
        strip_path: false

  - name: admin-backend
    url: http://host.docker.internal:7000
    plugins:
      - name: rate-limiting
        config:
          minute: 200
      - name: cors
        config:
          origins:
            - http://localhost:3000
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - Origin
            - X-Requested-With
          credentials: true
          max_age: 3600
    routes:
      - name: admin-catchall-routes
        paths:
          - /api/v1/admin
          - /api/v1/admin/
          - /api/v1/admin/(.*)
        strip_path: false
